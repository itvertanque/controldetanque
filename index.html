<!DOCTYPE html> 
<html> 
  <head> 
  <meta charset="UTF-8">
  <title>Control Tanque Sistemas ITVER</title>
  <link rel="stylesheet" type="text/css" href="estilos.css">
  <script src='mqttws31.js' type='text/javascript'></script>
  <script src="jquery.js"></script>
  <link rel="icon" type="image/png" href="petrolf.png" /> 
 </head> 

 
<body> 
<center>

<table border="0">

<tr>
  <td colspan="3">
  <center>
  <a><img src="titu.png" alt=""></a>
  <div id="txtcheck">ACTIVAR</div>
  <label class="switch3">
  <input type="checkbox" id="botontest" onclick='OnOff3()'>
  <span class="slider round3"></span></label>
  <a id="br1"><br><br><br></a>
  <div><img id="imgEstado" src="nopetrol.png"></div>
  <div><a id="estado">Medio</a></div>
  <a id="logoitv"><img src="itver.png" alt=""></a>
  <br>
  </center>
  </td>
</tr>


<tr>


  <td><center>
  <div id="ledbajo">
    <svg width="300" height="225" viewBox="0 0 640 480">
      <defs>
        <linearGradient id="svg_6" x1="0" y1="0" x2="1" y2="0">
          <stop stop-color="#bfbfbf" offset="0" />
          <stop stop-color="#404040" offset="1" />
        </linearGradient>
        <linearGradient id="svg_11" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop id="led1" stop-color="rgb(0,0,0)" stop-opacity="0.992188" offset="0" />
          <stop id="led1.1" stop-color="#9b9b9b" stop-opacity="0.988281" offset="1" />
        </linearGradient>
        <linearGradient id="svg_14" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0" />
          <stop id="led1.2" stop-color="#9b9b9b" stop-opacity="0.984375" offset="0.703125" />
        </linearGradient>
      </defs>
      <g>
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125" id="svg_3"
          fill-opacity="0.77" transform="rotate(90, 320, 240)" />
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64" cx="319.252837"
          cy="239.999045" r="160" id="svg_7" />
        <circle fill="url(#svg_11)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698" r="150"
          id="svg_8" />
        <ellipse fill="url(#svg_14)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194"
          rx="75.675959" ry="44.402987" id="svg_20" transform="rotate(-47.7626, 250.18, 170.125)" />
      </g>
    </svg>
  </div>
  </label>
  </center></td>


<td><center>
  <div id="ledmedio">
    <svg width="300" height="225" viewBox="0 0 640 480">
      <defs>
        <linearGradient id="svg_26" x1="0" y1="0" x2="1" y2="0">
          <stop stop-color="#bfbfbf" offset="0" />
          <stop stop-color="#404040" offset="1" />
        </linearGradient>
        <linearGradient id="svg_211" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop id="led2" stop-color="rgb(0,0,0)" stop-opacity="0.992188" offset="0" />
          <stop id="led2.1" stop-color="#9b9b9b" stop-opacity="0.988281" offset="1" />
        </linearGradient>
        <linearGradient id="svg_214" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0" />
          <stop id="led2.2" stop-color="#9b9b9b" stop-opacity="0.984375" offset="0.703125" />
        </linearGradient>
      </defs>
      <g>
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125" id="svg_23"
          fill-opacity="0.77" transform="rotate(90, 320, 240)" />
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64" cx="319.252837"
          cy="239.999045" r="160" id="svg_27" />
        <circle fill="url(#svg_211)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698" r="150"
          id="svg_28" />
        <ellipse fill="url(#svg_214)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194"
          rx="75.675959" ry="44.402987" id="svg_220" transform="rotate(-47.7626, 250.18, 170.125)" />
      </g>
    </svg>
  </div>
  </label>
</center></td>


  <td><center>
  <div id="ledalto">
    <svg width="300" height="225" viewBox="0 0 640 480">
      <defs>
        <linearGradient id="svg_36" x1="0" y1="0" x2="1" y2="0">
          <stop stop-color="#bfbfbf" offset="0" />
          <stop stop-color="#404040" offset="1" />
        </linearGradient>
        <linearGradient id="svg_311" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop id="led3" stop-color="rgb(0,0,0)" stop-opacity="0.992188" offset="0" />
          <stop id="led3.1" stop-color="#9b9b9b" stop-opacity="0.988281" offset="1" />
        </linearGradient>
        <linearGradient id="svg_314" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
          <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0" />
          <stop id="led3.2" stop-color="#9b9b9b" stop-opacity="0.984375" offset="0.703125" />
        </linearGradient>
      </defs>
      <g>
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125" id="svg_33"
          fill-opacity="0.77" transform="rotate(90, 320, 240)" />
        <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64" cx="319.252837"
          cy="239.999045" r="160" id="svg_37" />
        <circle fill="url(#svg_311)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698" r="150"
          id="svg_38" />
        <ellipse fill="url(#svg_314)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194"
          rx="75.675959" ry="44.402987" id="svg_320" transform="rotate(-47.7626, 250.18, 170.125)" />
      </g>
    </svg>
  </div>
  </label>
  </center></td>
  </tr>
 
  <tr>
  <td colspan="3">
  <center>
  <h1><a id="txtmedio">No se Recibe Nivel</a></h1>
  </center>
  </td></tr>
</table>
</center>

</body>
</html>











<script type="text/javascript">

usuario = 'proyectos';
contrasena = '123456789';

check="OFF";
nivel=0;
strEstado=" ";
strEstadoUltimo=" ";
$("#imgEstado").hide();
$("#estado").hide();
$("#logoitv").show();


    function OnOff3(){
        if (check == "OFF"){
          message = new Paho.MQTT.Message("ON");
          message.destinationName = '/' + usuario + '/check'
          client.send(message);
      }
        else if (check == "ON"){
          message = new Paho.MQTT.Message("OFF");
          message.destinationName = '/' + usuario + '/check'
          client.send(message);
      }
         
         };  

    function onConnect() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("onConnect");
        client.subscribe("#");
      }
        
      // called when the client loses its connection
    function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0) {
          console.log("onConnectionLost:", responseObject.errorMessage);
          setTimeout(function() { client.connect() }, 5000);
        }
      }
      // called when a message arrives
      function onMessageArrived(message) {
        if (message.destinationName == '/' + usuario + '/' + 'nivel') { 
       nivel= parseInt(message.payloadString);
       
          if (nivel == 0) {
            strEstado = "Vacio";
            document.getElementById("imgEstado").src = "nopetrol.png"
            document.getElementById("txtmedio").style.color = "red";
            document.getElementById("txtmedio").textContent = "Vacio";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led1.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led1.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3.2").setAttribute("stop-color", "#9b9b9b");
          }
          else if (nivel == 1) {
            strEstado = "Bajo";
            document.getElementById("imgEstado").src = "petrole.png"
            document.getElementById("txtmedio").style.color = "orange";
            document.getElementById("txtmedio").textContent = "Bajo";
            document.getElementById("led1").setAttribute("stop-color", "rgb(130,130,032)");
            document.getElementById("led1.1").setAttribute("stop-color", "rgb(255,164,032)");
            document.getElementById("led1.2").setAttribute("stop-color", "rgb(255,164,032)");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3.2").setAttribute("stop-color", "#9b9b9b");
          }
          else if (nivel== 2 ) {
            strEstado = "Error1";
            document.getElementById("imgEstado").src = "error.png"
            document.getElementById("txtmedio").style.color = "red";
            document.getElementById("txtmedio").textContent = "Error Flotador 1 Averiado";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led1.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led1.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led2.2").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led3").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3.2").setAttribute("stop-color", "#9b9b9b");
          }
          else if (nivel == 3) {
            strEstado = "Medio";
            document.getElementById("imgEstado").src = "petrol.png"
            document.getElementById("txtmedio").style.color = "green";
            document.getElementById("txtmedio").textContent = "Medio";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,100,47)");
            document.getElementById("led1.1").setAttribute("stop-color", "rgb(0,153,47)");
            document.getElementById("led1.2").setAttribute("stop-color", "rgb(0,153,47)");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,100,47)");
            document.getElementById("led2.1").setAttribute("stop-color", "rgb(0,153,47)");
            document.getElementById("led2.2").setAttribute("stop-color", "rgb(0,153,47)");
            document.getElementById("led3").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3.2").setAttribute("stop-color", "#9b9b9b");
          }
          else if (nivel == 4) {
            strEstado = "Error2";
            document.getElementById("imgEstado").src = "error.png"
            document.getElementById("txtmedio").style.color = "red";
            document.getElementById("txtmedio").textContent = "Error Flotador 1 y 2 Averiados";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led1.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led1.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led3.2").setAttribute("stop-color", "rgb(250,0,0)");
          }
          else if (nivel == 5) {
            strEstado = "Error3";
            document.getElementById("imgEstado").src = "error.png"
            document.getElementById("txtmedio").style.color = "red";
            document.getElementById("txtmedio").textContent = "Error Flotador 2 Averiado";
            document.getElementById("led1").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led1.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led1.2").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led3").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led3.2").setAttribute("stop-color", "rgb(250,0,0)");
          }
          else if (nivel == 6) {
            strEstado = "Error4";
            document.getElementById("imgEstado").src = "error.png"
            document.getElementById("txtmedio").style.color = "red";
            document.getElementById("txtmedio").textContent = "Error Flotador 1 Averiado";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,0,0)");
            document.getElementById("led1.1").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led1.2").setAttribute("stop-color", "#9b9b9b");
            document.getElementById("led2").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led2.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led2.2").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led3").setAttribute("stop-color", "rgb(100,0,0)");
            document.getElementById("led3.1").setAttribute("stop-color", "rgb(250,0,0)");
            document.getElementById("led3.2").setAttribute("stop-color", "rgb(250,0,0)");
          }
          else if (nivel == 7) {
            strEstado = "Lleno";
            document.getElementById("imgEstado").src = "petrolf.png"
            document.getElementById("txtmedio").style.color = "blue";
            document.getElementById("txtmedio").textContent = "Lleno";
            document.getElementById("led1").setAttribute("stop-color", "rgb(0,30,147)");
            document.getElementById("led1.1").setAttribute("stop-color", "rgb(0,53,197)");
            document.getElementById("led1.2").setAttribute("stop-color", "rgb(0,53,197)");
            document.getElementById("led2").setAttribute("stop-color", "rgb(0,30,147)");
            document.getElementById("led2.1").setAttribute("stop-color", "rgb(0,53,197)");
            document.getElementById("led2.2").setAttribute("stop-color", "rgb(0,53,197)");
            document.getElementById("led3").setAttribute("stop-color", "rgb(0,30,147)");
            document.getElementById("led3.1").setAttribute("stop-color", "rgb(0,53,197)");
            document.getElementById("led3.2").setAttribute("stop-color", "rgb(0,53,197)");
          }
          else{
            strEstado = "Syntaxys Error"; 
          }

          }

      if (message.destinationName == '/' + usuario + '/' + 'check') { 
           check = message.payloadString;
           if (check == "ON") {
              document.getElementById("botontest").checked=true;
              document.getElementById("txtcheck").textContent = "DESACTIVAR";
              $("#imgEstado").show();
              $("#logoitv").hide();
            }
            else if (check == "OFF") {
              document.getElementById("estado").textContent ="Medio";
              document.getElementById("botontest").checked=false;
              document.getElementById("txtcheck").textContent = "ACTIVAR";
              document.getElementById("imgEstado").src = "nopetrol.png"

              check="OFF";
              nivel=0;
              strEstado=" ";
              strEstadoUltimo=" ";
              $("#estado").hide();
              $("#imgEstado").hide();
              $("#logoitv").show();
              document.getElementById("txtmedio").style.color = "red";
              document.getElementById("txtmedio").textContent = "No se Recibe Nivel";
            }
          }

 }
        function onFailure(invocationContext, errorCode, errorMessage) {
          var errDiv = document.getElementById("error");
          errDiv.textContent = "Could not connect to WebSocket server, most likely you're behind a firewall that doesn't allow outgoing connections to port 36163";
          errDiv.style.display = "block";
        }
        
        var clientId = "ws" + Math.random();
        // Create a client instance
        var client = new Paho.MQTT.Client("tailor.cloudmqtt.com", 35723, clientId);
        
        // set callback handlers
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;
        
        // connect the client
        client.connect({
          useSSL: true,
          userName: usuario,
          password: contrasena,
          onSuccess: onConnect,
          onFailure: onFailure
        });
</script>
